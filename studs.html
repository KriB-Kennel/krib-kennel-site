<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="theme-color" content="#000000">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<title>KriB Kennel | Studs</title>
<meta name="description" content="KriB Kennel Studs & Pedigree." />

<link rel="stylesheet" href="./styles.css" />
<link rel="stylesheet" href="./gold-rain.css" />
</head>

<body>

<div class="bg"></div>
<div class="gold-rain"></div>

<main class="wrap">

<header class="card header">
  <button class="navbtn" id="navBtn">
    <div class="navicon"><span></span><span></span><span></span></div>
  </button>

  <img class="logo" id="logo" src="./assets/logo.png" alt="Logo">
  <div class="tagline" id="tagline"></div>

  <div class="lang">
    <button class="langbtn" id="langEN">EN</button>
    <button class="langbtn" id="langES">ES</button>
  </div>
</header>

<section class="card section">
  <h2 class="section-title" id="studsTitle">Studs</h2>
  <p class="section-lead" id="studsLead"></p>
  <div class="dogs-grid" id="studsGrid"></div>
</section>

<footer class="footer">
  <div class="brand" id="footerBrand"></div>
  <div class="copy">
    © <span id="year"></span> •
    <a id="footerLink" href="#" target="_blank">RaymondDevelop</a>
  </div>
</footer>

</main>

<script src="./config.js"></script>

<script>
const $ = (id)=>document.getElementById(id);

function safeText(el,v){ if(el) el.textContent=v??""; }
function safeHref(el,v){ if(el&&v) el.href=v; }
function safeSrc(el,v){ if(el&&v) el.src=v; }

Object.entries(SITE.colors||{}).forEach(([k,v])=>{
  document.documentElement.style.setProperty(`--${k}`,v);
});

safeSrc($("logo"), SITE.assets?.logo);
safeText($("tagline"), SITE.header?.tagline);

function getLang(){
  return localStorage.getItem("lang") || SITE.defaultLang || "en";
}

function paintLangButtons(lang){
  $("langEN")?.classList.toggle("active", lang==="en");
  $("langES")?.classList.toggle("active", lang==="es");
}

function t(key){
  const lang=getLang();
  return SITE.i18n?.[lang]?.[key] ?? SITE.i18n?.en?.[key] ?? null;
}

function extractYouTubeId(input){
  if(!input) return "";
  const s=String(input);

  const a=s.match(/youtu\.be\/([a-zA-Z0-9_-]+)/);
  if(a) return a[1];

  const b=s.match(/\/shorts\/([a-zA-Z0-9_-]+)/);
  if(b) return b[1];

  const c=s.match(/[?&]v=([a-zA-Z0-9_-]+)/);
  if(c) return c[1];

  return "";
}

function renderStud(){

  const grid=$("studsGrid");
  if(!grid) return;

  const lang=getLang();

  const items =
    SITE.studs?.items?.[lang] ||
    SITE.studs?.items?.en ||
    [];

  const d = items[0];

  grid.innerHTML="";
  if(!d) return;

  const card=document.createElement("article");
  card.className="dog";

  const videoId=extractYouTubeId(d.video || "");

  card.innerHTML = `
    <img class="dog-img"
      src="${d.img || ""}"
      alt="${d.name || ""}"
      loading="lazy"
      decoding="async">

    <div class="dog-body">

      <h3 class="dog-name">${d.name || ""}</h3>

      <p class="dog-ped">${d.pedigree || ""}</p>

      <p class="dog-desc">${d.desc || ""}</p>

      ${d.certImg ? `
        <a href="#" class="mini-link" id="pedLink">
          Pedigree
        </a>

        <div class="photo" id="pedWrap" style="display:none;margin-top:10px;">
          <img src="${d.certImg}" alt="Pedigree Certificate"
               loading="lazy" decoding="async">
        </div>
      ` : ``}

      ${videoId ? `
      <div class="photo" style="margin-top:14px;">
        <div style="position:relative;width:100%;padding-top:56.25%;overflow:hidden;border-radius:inherit;">
          <iframe
            style="position:absolute;inset:0;width:100%;height:100%;border:0;"
            loading="lazy"
            allowfullscreen
            src="https://www.youtube-nocookie.com/embed/${videoId}">
          </iframe>
        </div>
      </div>
      ` : ""}

    </div>
  `;

  grid.appendChild(card);

  const pedLink=card.querySelector("#pedLink");
  const pedWrap=card.querySelector("#pedWrap");

  if(pedLink && pedWrap){
    pedLink.addEventListener("click",(e)=>{
      e.preventDefault();

      const open = pedWrap.style.display==="none";
      pedWrap.style.display = open ? "block" : "none";

      const lang=getLang();
      pedLink.textContent = open
        ? (lang==="es" ? "Ocultar certificado" : "Hide certificate")
        : "Pedigree";
    });
  }
}

function applyLang(){

  const lang=getLang();

  paintLangButtons(lang);
  document.documentElement.lang=lang;

  safeText($("tagline"), t("tagline") || "");
  safeText($("studsTitle"), t("navStuds") || "Males");
  safeText($("studsLead"), t("studsLead") || "");

  renderStud();
}

$("langEN")?.addEventListener("click",()=>{
  localStorage.setItem("lang","en");
  applyLang();
});

$("langES")?.addEventListener("click",()=>{
  localStorage.setItem("lang","es");
  applyLang();
});

safeText($("footerBrand"), SITE.brand);
safeHref($("footerLink"), SITE.footer?.companyUrl);
safeText($("footerLink"), SITE.footer?.companyLabel);
$("year").textContent = new Date().getFullYear();

applyLang();
</script>

</body>
</html>
